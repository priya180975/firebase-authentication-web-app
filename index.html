<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="container">
        
        <div class="sign-in-page">
            <div class="heading">Log In</div>
            <div class="alter">
                New member? 
                <button  id="sign-up-page-btn" >Sign Up</button>
            </div>
            <div class="error error-sign-in">Error</div>
            <div class="inputs">
                <label for="sign-in-email">Email address</label>
                <input type="email" name="sign-in-email" id="sign-in-email">
            </div>
            <div class="inputs">
                <label for="password">Password</label>
                <div class="password-input">
                    <input type="password" name="sign-in-password" id="sign-in-password">
                    <i class="fa-eye-slash fa-solid password-show-hide" data-name="sign-in-"></i>
                </div>
            </div>
            <button class="submit-btn" id="sign-in">Sign In</button>
        </div>   

        <div class="sign-up-page">
            <div class="heading">Sign Up</div>
            <div class="alter">
                Already a member?
                <button  id="sign-in-page-btn" >Sign In</button>
            </div>
            <div class="error error-sign-up">Error</div>
            <div class="password-warn">Password must be 8 letters long having a symbol, upper and lower case letters and a number</div>
            <div class="names">
                <div class="inputs">
                    <label for="sign-up-name">Name</label>
                    <input type="text" name="sign-up-name" id="sign-up-name" maxlength="10" required>
                </div>
                <div class="inputs">
                    <label for="sign-up-surname">Surname</label>
                    <input type="text" name="sign-up-surname" id="sign-up-surname" maxlength="10" required>
                </div>
            </div>
            <div class="inputs">
                <label for="sign-up-email">Email address</label>
                <input type="email" name="sign-up-email" id="sign-up-email"required>
            </div>
            <div class="inputs">
                <label for="sign-up-password">Password</label>
                <div class="password-input">
                    <input type="password" name="sign-up-password" id="sign-up-password" required>
                    <i class="fa-eye-slash fa-solid  password-show-hide" data-name="sign-up-"></i>
                </div>
            </div>
            <button class="submit-btn" id="sign-up">Sign Up</button>
            
        </div>
        </div>
    </div>

    <script type="module">
        import * as myFun from "./functions.js"
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-app.js";
        import { getDatabase } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword ,  signInWithEmailAndPassword} from "https://www.gstatic.com/firebasejs/9.9.1/firebase-auth.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyDQs1uL7nNmUCE1gj15woJoV4S9ap4kNtA",
          authDomain: "fir-auth-6ed98.firebaseapp.com",
          databaseURL: "https://fir-auth-6ed98-default-rtdb.firebaseio.com",
          projectId: "fir-auth-6ed98",
          storageBucket: "fir-auth-6ed98.appspot.com",
          messagingSenderId: "787784602234",
          appId: "1:787784602234:web:5bb2728d18b88264cfe1c3",
          measurementId: "G-8TQDDQKDS1"
        };
      
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        const database =getDatabase(app);

        let signUpFormBtn=document.querySelector("#sign-up")
        let signInFormBtn=document.querySelector("#sign-in")
        signUpFormBtn.addEventListener("click",signup)
        signInFormBtn.addEventListener("click",signin)

        function signup()
        {
            let email=document.querySelector("#sign-up-email").value
            let password=document.querySelector("#sign-up-password").value
            let surname=document.querySelector("#sign-up-surname").value
            let name=document.querySelector("#sign-up-name").value
            let error=document.querySelector(".error-sign-up")

            if(myFun.checkNameValid(name,error)&&
            myFun.checkSurnameValid(surname,error)&&
            myFun.checkEmailValid(email,error)&&
            myFun.checkPasswordValid(password,error))
            {
                const auth = getAuth();

                createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log("user created")
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.log(errorMessage)
                });
            }
            else
            {
                console.log("err")
            }
        }


        function signin()
        {
            let signInEmail=document.querySelector("#sign-in-email").value
            let signInPassword=document.querySelector("#sign-in-password").value
            let error=document.querySelector(".error-sign-in")
            if(myFun.checkEmailValid(signInEmail,error)&&
            myFun.checkPasswordValid(signInPassword,error))
            {
                console.log("done")

                const auth = getAuth();
                signInWithEmailAndPassword(auth, signInEmail, signInPassword)
                .then((userCredential) => {
                    // Signed in 
                    const user = userCredential.user;
                    console.log("logged in")
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    console.log(errorMessage)
                });

            }
            else
            {
                console.log("err")
            }
        }


    </script>

    <script src="script.js"></script>

</body>
</html>